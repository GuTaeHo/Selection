## 앱 시닝(App Thinning)?

결론부터 말하자면 앱 사용자가 자신의 디바이스에 맞는 리소스만 다운로드 받을 수 있도록 애플에서 발표한 개념

<br />

iOS 앱은 크게 **실행가능한 코드**와 **리소스**로 구성되어있음

<br />

**실행가능한 코드에는...**

> 32비트(armv7, iPhone 5s 이전) 및 64비트(arm64, iPhone 5 이후) 기반 cpu가 읽을 수 있는 명령으로 구성된 코드로 나뉨

앱에는 각 CPU 아키텍처(기기의 CPU 종류)에 맞게 동작할 코드가 여러개(32, 64bit) 필요함

<br />

**리소스(이미지, 영상, 그래픽, 음원)에는...**

asset 1x, 2x, 3x 및 아이폰용, 아이패드용 전용 리소스가 별도로 존재할 수 있음

그래픽 기반 앱일 경우 기기 성능에 맞게 품질 or 성능 조정을 할 수 있도록 각 에셋에 대한 다른 질감(textures) 를 별도로 여러개 가질 수 있음 

오디오의 경우에도 낮은 비트레이트, 높은 비트레이트 등 기기 성능에 따라 차별화를 꾀할 수 있음

<br />

위 모든 소스코드와 리소스를 한 앱에 담고 있다면 당연하게도 앱사이즈가 비대해지며, 그만큼 메모리 및 디스크를 많이 사용할 것이기 때문에 **내 기기에 필요한 것만 내려받을 수 없을까?** 라는 궁금증에서 애플이 발표한 것이 **앱 슬라이싱(App Slicing)** 임

<br />

개발자가 iOS 앱을 만들어 모든 리소스가 포함된 범용 앱(universal app)을 앱스토어 서버에 업로드 하면, 기기에 특성에 맞는 IPA를 여러개 생성함

<br />

<br />

## LLVM(Low Level Vertual Machine)?

비트코드를 알아보기에 앞서 LLVM이란 고급언어(Object-C, Swift, Python, Ruby)로 작성된 소스코드를 중간 언어(intermediate) 또는 기계어(machine code)로 컴파일 할 때 사용하는 컴파일러(모듈)임

<br />

**LLVM 은 세가지 부분이 있음**

1. 프론트 엔드
   C++, Swift, Python 과 같은 고급언어들을 읽어 파싱한 뒤, **IR(Intermdediate Reperesntation)형태**로 변경함, IR은 어셈블리어와 비슷한 저급 프로그래밍 언어 라고함

2. 미들엔드
   
   변환된 IR을 최적화 함
   
   중복코드, 인라인 함수, 데드 루프 삭제 등등

3. 백엔드
   IR을 타겟에 맞는 **기계어로 컴파일**함

<br />

<br />

## 비트코드(Bitcode)?

**사람도 컴퓨터도 이해할 수 없는 중간단계의 코드**

> 자바의 바이트코드와 비슷한 느낌 (단, 자바는 해당 플랫폼의 가상머신이 바이트코드를 읽어 바로 실행하지만, 비트코드는 앱 스토어가 이미 컴파일된 여러 버전의 앱을 가지고있고, 필요한 곳에 해당 버전을 내려준다는 점이 약간 다름)

<br />

iOS 앱을 만들어 앱 스토어에 업로드 하기 전, 해당 프로젝트의 **Bitcode 를 활성화**하면

앱 스토어가 앱을 내려줄 때 해당기기가 실행할 수 있는 형태로 컴파일 된 앱을 내려다줌

<br />

bitcode가 나오기전에는 앱이 실행 될 수 있는 모든 환경 
32bit or 64bit 및 armv6/armv7/arm64 에 대한 모든 바이너리를 생성해 하느의 파일로 합쳐 앱 사이즈가 비대했음

<br />

비트코드는 **앱 슬라이싱과 함께** 앱을 최적화하는데 사용됨

<br />

<br />

### 참조

[LLVM이란](https://zeddios.tistory.com/1175)

[App Thinning. 그리고 Bitcode](https://zeddios.tistory.com/655)
