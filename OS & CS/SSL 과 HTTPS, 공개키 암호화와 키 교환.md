# SSL 과 HTTPS, 공개키 암호화와 키 교환

[SSL & TSL 인증서 설치](../Server/SSL%20&%20TSL%20인증서%20발급%20및%20설치.md)는 여기로

[Proxyman 으로 HTTPS 로깅하기](../iOS/Proxy%20&%20Proxyman.md)는 여기로

</br>

## HTTPS

웹 상에서 문서를 교환하기 위해 고안된 `HTTP`는 전송되는 데이터가 평문으로 전송되어 누구나 다 볼 수 있다는 큰 문제점을 가지고 있었다.

`HTTPS` 는 전송되는 데이터를 암호화하여, 제 3자가 훔쳐볼 수 없도록 하기 위해 고안되었고,  
HTTP 를 SSL 프로토콜에 맞게 구현한 구현체라고 할 수 있다.

이 데이터를 암호화하기 위해 사용되는 보안 프로토콜을 SSL 이라고 부른다.

</br>

## SSL(Secure Socket Layer)

TCP/IP 로 네트워크 통신을 할 때, 보안을 제공하기 위해 설계된 프로토콜

이 SSL 이 발전되어 표준화가 되면서 TSL(Transport Layer Socket) 이 되었고, 둘은 동일한 기술이다.

이 프로토콜이 HTTP 에 적용됐다면 `HTTPS`,  
FTP 에 적용됐다면 `FTPS` (`SFTP` 가 아님) 로 불린다

</br>

## 공개키 암호 방식

대칭키는 암, 복호화를 하나의 키로 진행하다보니 배송 중 키가 탈취되는 순간(서로의 키를 교환해야 복호화가 가능함) 해커도 정보를 볼 수 있다.

이를 해결하기 위해 나온 방식이 **공개키 또는 비대칭키** 방식이다.

</br>

### 전송예시

데이터를 안전하게 전송하고 싶어하는 `A` 와 `B` 가 있다.

1. `A`와 `B`는 각각 하나의 개인키와 공개키를 가지고있다.
2. 개인 키는 아무에게도 공개하지않고 오직 자신만 가지고있다.
3. `A`는 `B`의 공개키를 통해 자신의 정보(`M`)를 암호화한다.
4. `M`은 `B`의 개인키로만 복호화가 가능하다.

</br>

만약 해커(`H`)가 `B`의 공개키와 `M`을 획득해도 이 정보를
볼 수 있는 방법은 `B`만 가지고있는 개인키로 복호화하는 방법밖에없다.

</br>

개인키가 노출되지 않는다는 가정하에 안전한 방법이지만
대칭키 방식에 비해 속도가 느리기 때문에 모든 통신을
공개키 방식으로 하는 것은 부담스럽다.

</br>

우리가 일반적으로 많이 사용하는 HTTPS 프로토콜은 클라이언트와
서버간 효율적인 데이터 전송을 위해 위 방식을 결합한
형태(단, RSA 로 암호화된 SSL 인증서에만 해당)로 설계되었다.

</br>

### HTTPS 키 교환 방식

**데이터 전송 전 키 교환 방식 [그림 1-1 참고]**

1. 먼저 CA에서 발급해준 SSL 인증서에 포함되어있는 서버측의 공개키(`B`)를 획득한다.
   - 모든 브라우저는 CA 목록을 가지고 있다
2. 클라이언트에서 임의의 대칭키(`A`)를 생성
3. 클라이언트 대칭키(`A`)를 서버 공개키(`B`)로 암호화하고 암호화된 대칭키(`A`\`)를 서버로 전달
4. 서버는 암호화된 대칭키(`C`) 를 자신의 개인키(`B`\`) 로 복호화
5. 이제 클라이언트와 서버는 동일한 대칭키로 통신(세션 수립)

</br>

\+ 25.8.12 추가  
위 내용은 초기 TLS 버전(RSA 기반 키 교환) 에서 동작하는 방식이며 현재 TLS 버전에서는 디피-헬만 암호화 방식을 사용하고 있다.

</br>

**그림 1. HTTPS 통신 시 오고가는 패킷**

![HTTPS 통신 시 오고가는 패킷](https://github.com/GuTaeHo/Selection/assets/63102954/4ee229d3-ceb5-4360-9d8c-dda1b12f008c)

**그림 1-1. TLS_RSA 키 교환 방법**

![TLS_RSA 키 교환 방법](https://github.com/GuTaeHo/Selection/assets/63102954/3d98a6ee-2761-4cf9-9505-b708a4ef3257)

</br>

### 참고

- https://aws-hyoh.tistory.com/47 (공개키 암호화)
- https://medium.com/@wynn1275/https%EC%9D%98-cipher-suite-%EB%B0%8F-rsa-dhe-%ED%82%A4-%EA%B5%90%ED%99%98-%EB%B0%A9%EB%B2%95-75eb36b101c8 (RSA, DHE 키 교환방법)
